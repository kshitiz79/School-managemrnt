{
    "sourceFile": "src/pages/masters/SubjectGroups.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1755994925598,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1755995169611,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n   Trash2,\n   BookOpen,\n   X,\n } from 'lucide-react'\n-import Table from '../../components/ui/Table'\n+import { Table } from '../../components/ui/Table'\n import Input from '../../components/ui/Input'\n import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '../../components/ui/Dialog'\n import LoadingSkeleton from '../../components/ui/LoadingSkeleton'\n import ErrorState from '../../components/ui/ErrorState'\n"
                },
                {
                    "date": 1756039695823,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -16,13 +16,12 @@\n import LoadingSkeleton from '../../components/ui/LoadingSkeleton'\n import ErrorState from '../../components/ui/ErrorState'\n import EmptyState from '../../components/ui/EmptyState'\n import Pagination from '../../components/ui/Pagination'\n-import Dropdown from '../../components/ui/Dropdown'\n+import { Dropdown } from '../../components/ui/Dropdown'\n import { subjectGroupsApi } from '../../lib/api/subjectGroups'\n import { subjectsApi } from '../../lib/api/subjects'\n import { classesApi } from '../../lib/api/classes'\n-import { validateRequired } from '../../lib/validators'\n \n const SubjectGroups = () => {\n   const [searchTerm, setSearchTerm] = useState('')\n   const [currentPage, setCurrentPage] = useState(1)\n@@ -106,17 +105,17 @@\n \n   const validateForm = () => {\n     const newErrors = {}\n \n-    if (!validateRequired(formData.name)) {\n+    if (!formData.name || formData.name.trim() === '') {\n       newErrors.name = 'Group name is required'\n     }\n \n-    if (!validateRequired(formData.code)) {\n+    if (!formData.code || formData.code.trim() === '') {\n       newErrors.code = 'Group code is required'\n     }\n \n-    if (!validateRequired(formData.classId)) {\n+    if (!formData.classId || formData.classId.trim() === '') {\n       newErrors.classId = 'Class is required'\n     }\n \n     if (formData.subjects.length === 0) {\n"
                }
            ],
            "date": 1755994925598,
            "name": "Commit-0",
            "content": "import React, { useState } from 'react'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport {\n  Plus,\n  Search,\n  Filter,\n  MoreHorizontal,\n  Edit,\n  Trash2,\n  BookOpen,\n  X,\n} from 'lucide-react'\nimport Table from '../../components/ui/Table'\nimport Input from '../../components/ui/Input'\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '../../components/ui/Dialog'\nimport LoadingSkeleton from '../../components/ui/LoadingSkeleton'\nimport ErrorState from '../../components/ui/ErrorState'\nimport EmptyState from '../../components/ui/EmptyState'\nimport Pagination from '../../components/ui/Pagination'\nimport Dropdown from '../../components/ui/Dropdown'\nimport { subjectGroupsApi } from '../../lib/api/subjectGroups'\nimport { subjectsApi } from '../../lib/api/subjects'\nimport { classesApi } from '../../lib/api/classes'\nimport { validateRequired } from '../../lib/validators'\n\nconst SubjectGroups = () => {\n  const [searchTerm, setSearchTerm] = useState('')\n  const [currentPage, setCurrentPage] = useState(1)\n  const [pageSize] = useState(10)\n  const [showCreateDialog, setShowCreateDialog] = useState(false)\n  const [showEditDialog, setShowEditDialog] = useState(false)\n  const [selectedGroup, setSelectedGroup] = useState(null)\n  const [selectedItems, setSelectedItems] = useState([])\n  const [formData, setFormData] = useState({\n    name: '',\n    code: '',\n    description: '',\n    classId: '',\n    subjects: [],\n    isActive: true,\n  })\n  const [errors, setErrors] = useState({})\n  const [availableSubjects, setAvailableSubjects] = useState([])\n\n  const queryClient = useQueryClient()\n\n  const {\n    data: groupsData,\n    isLoading,\n    error,\n  } = useQuery({\n    queryKey: [\n      'subjectGroups',\n      { page: currentPage, pageSize, search: searchTerm },\n    ],\n    queryFn: () =>\n      subjectGroupsApi.getAll({\n        page: currentPage,\n        pageSize,\n        search: searchTerm,\n      }),\n  })\n\n  const { data: subjectsData } = useQuery({\n    queryKey: ['subjects', 'all'],\n    queryFn: () => subjectsApi.getAll({ all: true }),\n  })\n\n  const { data: classesData } = useQuery({\n    queryKey: ['classes', 'all'],\n    queryFn: () => classesApi.getAll({ all: true }),\n  })\n\n  const createMutation = useMutation({\n    mutationFn: subjectGroupsApi.create,\n    onSuccess: () => {\n      queryClient.invalidateQueries(['subjectGroups'])\n      setShowCreateDialog(false)\n      resetForm()\n    },\n  })\n\n  const updateMutation = useMutation({\n    mutationFn: ({ id, data }) => subjectGroupsApi.update(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries(['subjectGroups'])\n      setShowEditDialog(false)\n      resetForm()\n    },\n  })\n\n  const deleteMutation = useMutation({\n    mutationFn: subjectGroupsApi.delete,\n    onSuccess: () => {\n      queryClient.invalidateQueries(['subjectGroups'])\n    },\n  })\n\n  const bulkDeleteMutation = useMutation({\n    mutationFn: subjectGroupsApi.bulkDelete,\n    onSuccess: () => {\n      queryClient.invalidateQueries(['subjectGroups'])\n      setSelectedItems([])\n    },\n  })\n\n  const validateForm = () => {\n    const newErrors = {}\n\n    if (!validateRequired(formData.name)) {\n      newErrors.name = 'Group name is required'\n    }\n\n    if (!validateRequired(formData.code)) {\n      newErrors.code = 'Group code is required'\n    }\n\n    if (!validateRequired(formData.classId)) {\n      newErrors.classId = 'Class is required'\n    }\n\n    if (formData.subjects.length === 0) {\n      newErrors.subjects = 'At least one subject is required'\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = e => {\n    e.preventDefault()\n    if (!validateForm()) return\n\n    if (selectedGroup) {\n      updateMutation.mutate({ id: selectedGroup.id, data: formData })\n    } else {\n      createMutation.mutate(formData)\n    }\n  }\n\n  const handleEdit = group => {\n    setSelectedGroup(group)\n    setFormData({\n      name: group.name,\n      code: group.code,\n      description: group.description || '',\n      classId: group.classId,\n      subjects: group.subjects || [],\n      isActive: group.isActive,\n    })\n    setShowEditDialog(true)\n  }\n\n  const handleDelete = id => {\n    if (window.confirm('Are you sure you want to delete this subject group?')) {\n      deleteMutation.mutate(id)\n    }\n  }\n\n  const handleBulkDelete = () => {\n    if (\n      window.confirm(\n        `Are you sure you want to delete ${selectedItems.length} subject groups?`,\n      )\n    ) {\n      bulkDeleteMutation.mutate(selectedItems)\n    }\n  }\n\n  const handleAddSubject = subjectId => {\n    const subject = subjectsData?.data?.find(s => s.id === subjectId)\n    if (subject && !formData.subjects.find(s => s.id === subjectId)) {\n      setFormData({\n        ...formData,\n        subjects: [...formData.subjects, subject],\n      })\n    }\n  }\n\n  const handleRemoveSubject = subjectId => {\n    setFormData({\n      ...formData,\n      subjects: formData.subjects.filter(s => s.id !== subjectId),\n    })\n  }\n\n  const resetForm = () => {\n    setFormData({\n      name: '',\n      code: '',\n      description: '',\n      classId: '',\n      subjects: [],\n      isActive: true,\n    })\n    setErrors({})\n    setSelectedGroup(null)\n  }\n\n  const columns = [\n    {\n      key: 'select',\n      header: (\n        <input\n          type=\"checkbox\"\n          checked={selectedItems.length === groupsData?.data?.length}\n          onChange={e => {\n            if (e.target.checked) {\n              setSelectedItems(groupsData.data.map(item => item.id))\n            } else {\n              setSelectedItems([])\n            }\n          }}\n        />\n      ),\n      render: item => (\n        <input\n          type=\"checkbox\"\n          checked={selectedItems.includes(item.id)}\n          onChange={e => {\n            if (e.target.checked) {\n              setSelectedItems([...selectedItems, item.id])\n            } else {\n              setSelectedItems(selectedItems.filter(id => id !== item.id))\n            }\n          }}\n        />\n      ),\n    },\n    { key: 'code', header: 'Code', sortable: true },\n    { key: 'name', header: 'Name', sortable: true },\n    {\n      key: 'className',\n      header: 'Class',\n      render: item => item.class?.name || 'N/A',\n    },\n    {\n      key: 'subjectCount',\n      header: 'Subjects',\n      render: item => item.subjects?.length || 0,\n    },\n    {\n      key: 'isActive',\n      header: 'Status',\n      render: item => (\n        <span\n          className={`px-2 py-1 rounded-full text-xs ${\n            item.isActive\n              ? 'bg-green-100 text-green-800'\n              : 'bg-red-100 text-red-800'\n          }`}\n        >\n          {item.isActive ? 'Active' : 'Inactive'}\n        </span>\n      ),\n    },\n    {\n      key: 'actions',\n      header: 'Actions',\n      render: item => (\n        <Dropdown\n          trigger={<MoreHorizontal className=\"w-4 h-4\" />}\n          items={[\n            {\n              label: 'Edit',\n              icon: Edit,\n              onClick: () => handleEdit(item),\n            },\n            {\n              label: 'View Subjects',\n              icon: BookOpen,\n              onClick: () => console.log('View subjects for', item.id),\n            },\n            {\n              label: 'Delete',\n              icon: Trash2,\n              onClick: () => handleDelete(item.id),\n              className: 'text-red-600',\n            },\n          ]}\n        />\n      ),\n    },\n  ]\n\n  if (isLoading) return <LoadingSkeleton />\n  if (error) return <ErrorState message=\"Failed to load subject groups\" />\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Subject Groups</h1>\n        <button\n          onClick={() => setShowCreateDialog(true)}\n          className=\"bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700\"\n        >\n          <Plus className=\"w-4 h-4\" />\n          Add Subject Group\n        </button>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow\">\n        <div className=\"p-6 border-b\">\n          <div className=\"flex gap-4 items-center\">\n            <div className=\"flex-1\">\n              <Input\n                placeholder=\"Search subject groups...\"\n                value={searchTerm}\n                onChange={e => setSearchTerm(e.target.value)}\n                icon={Search}\n              />\n            </div>\n            <button className=\"p-2 border rounded-lg hover:bg-gray-50\">\n              <Filter className=\"w-4 h-4\" />\n            </button>\n            {selectedItems.length > 0 && (\n              <button\n                onClick={handleBulkDelete}\n                className=\"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700\"\n              >\n                Delete Selected ({selectedItems.length})\n              </button>\n            )}\n          </div>\n        </div>\n\n        {groupsData?.data?.length === 0 ? (\n          <EmptyState\n            title=\"No subject groups found\"\n            description=\"Get started by creating your first subject group\"\n            action={{\n              label: 'Add Subject Group',\n              onClick: () => setShowCreateDialog(true),\n            }}\n          />\n        ) : (\n          <>\n            <Table data={groupsData?.data || []} columns={columns} />\n            <div className=\"p-6 border-t\">\n              <Pagination\n                currentPage={currentPage}\n                totalPages={Math.ceil((groupsData?.total || 0) / pageSize)}\n                onPageChange={setCurrentPage}\n              />\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* Create Dialog */}\n      <Dialog\n        open={showCreateDialog}\n        onClose={() => {\n          setShowCreateDialog(false)\n          resetForm()\n        }}\n        title=\"Add New Subject Group\"\n        size=\"lg\"\n      >\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Class *</label>\n            <select\n              value={formData.classId}\n              onChange={e =>\n                setFormData({ ...formData, classId: e.target.value })\n              }\n              className={`w-full border rounded-lg px-3 py-2 ${errors.classId ? 'border-red-500' : ''}`}\n            >\n              <option value=\"\">Select Class</option>\n              {Array.isArray(classesData?.data) &&\n                classesData.data.map(cls => (\n                  <option key={cls.id} value={cls.id}>\n                    {cls.name}\n                  </option>\n                ))}\n            </select>\n            {errors.classId && (\n              <p className=\"text-red-500 text-sm mt-1\">{errors.classId}</p>\n            )}\n          </div>\n          <Input\n            label=\"Group Name\"\n            value={formData.name}\n            onChange={e => setFormData({ ...formData, name: e.target.value })}\n            error={errors.name}\n            required\n          />\n          <Input\n            label=\"Group Code\"\n            value={formData.code}\n            onChange={e => setFormData({ ...formData, code: e.target.value })}\n            error={errors.code}\n            required\n          />\n          <Input\n            label=\"Description\"\n            value={formData.description}\n            onChange={e =>\n              setFormData({ ...formData, description: e.target.value })\n            }\n            multiline\n            rows={3}\n          />\n\n          {/* Subject Selection */}\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Subjects *</label>\n            <div className=\"space-y-2\">\n              <select\n                onChange={e => {\n                  if (e.target.value) {\n                    handleAddSubject(e.target.value)\n                    e.target.value = ''\n                  }\n                }}\n                className=\"w-full border rounded-lg px-3 py-2\"\n              >\n                <option value=\"\">Add Subject</option>\n                {subjectsData?.data\n                  ?.filter(\n                    subject => !formData.subjects.find(s => s.id === subject.id)\n                  )\n                  .map(subject => (\n                    <option key={subject.id} value={subject.id}>\n                      {subject.name} ({subject.code})\n                    </option>\n                  ))}\n              </select>\n\n              {/* Selected Subjects */}\n              <div className=\"flex flex-wrap gap-2\">\n                {Array.isArray(formData.subjects) &&\n                  formData.subjects.map(subject => (\n                    <div\n                      key={subject.id}\n                      className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center gap-2\"\n                    >\n                      {subject.name}\n                      <button\n                        type=\"button\"\n                        onClick={() => handleRemoveSubject(subject.id)}\n                        className=\"hover:bg-blue-200 rounded-full p-1\"\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  ))}\n              </div>\n            </div>\n            {errors.subjects && (\n              <p className=\"text-red-500 text-sm mt-1\">{errors.subjects}</p>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              id=\"isActive\"\n              checked={formData.isActive}\n              onChange={e =>\n                setFormData({ ...formData, isActive: e.target.checked })\n              }\n            />\n            <label htmlFor=\"isActive\">Active</label>\n          </div>\n          <div className=\"flex gap-2 pt-4\">\n            <button\n              type=\"submit\"\n              disabled={createMutation.isPending}\n              className=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n            >\n              {createMutation.isPending ? 'Creating...' : 'Create Group'}\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => {\n                setShowCreateDialog(false)\n                resetForm()\n              }}\n              className=\"border px-4 py-2 rounded-lg hover:bg-gray-50\"\n            >\n              Cancel\n            </button>\n          </div>\n        </form>\n      </Dialog>\n\n      {/* Edit Dialog */}\n      <Dialog\n        open={showEditDialog}\n        onClose={() => {\n          setShowEditDialog(false)\n          resetForm()\n        }}\n        title=\"Edit Subject Group\"\n        size=\"lg\"\n      >\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Class *</label>\n            <select\n              value={formData.classId}\n              onChange={e =>\n                setFormData({ ...formData, classId: e.target.value })\n              }\n              className={`w-full border rounded-lg px-3 py-2 ${errors.classId ? 'border-red-500' : ''}`}\n            >\n              <option value=\"\">Select Class</option>\n              {Array.isArray(classesData?.data) &&\n                classesData.data.map(cls => (\n                  <option key={cls.id} value={cls.id}>\n                    {cls.name}\n                  </option>\n                ))}\n            </select>\n            {errors.classId && (\n              <p className=\"text-red-500 text-sm mt-1\">{errors.classId}</p>\n            )}\n          </div>\n          <Input\n            label=\"Group Name\"\n            value={formData.name}\n            onChange={e => setFormData({ ...formData, name: e.target.value })}\n            error={errors.name}\n            required\n          />\n          <Input\n            label=\"Group Code\"\n            value={formData.code}\n            onChange={e => setFormData({ ...formData, code: e.target.value })}\n            error={errors.code}\n            required\n          />\n          <Input\n            label=\"Description\"\n            value={formData.description}\n            onChange={e =>\n              setFormData({ ...formData, description: e.target.value })\n            }\n            multiline\n            rows={3}\n          />\n\n          {/* Subject Selection */}\n          <div>\n            <label className=\"block text-sm font-medium mb-1\">Subjects *</label>\n            <div className=\"space-y-2\">\n              <select\n                onChange={e => {\n                  if (e.target.value) {\n                    handleAddSubject(e.target.value)\n                    e.target.value = ''\n                  }\n                }}\n                className=\"w-full border rounded-lg px-3 py-2\"\n              >\n                <option value=\"\">Add Subject</option>\n                {subjectsData?.data\n                  ?.filter(\n                    subject => !formData.subjects.find(s => s.id === subject.id)\n                  )\n                  .map(subject => (\n                    <option key={subject.id} value={subject.id}>\n                      {subject.name} ({subject.code})\n                    </option>\n                  ))}\n              </select>\n\n              {/* Selected Subjects */}\n              <div className=\"flex flex-wrap gap-2\">\n                {Array.isArray(formData.subjects) &&\n                  formData.subjects.map(subject => (\n                    <div\n                      key={subject.id}\n                      className=\"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm flex items-center gap-2\"\n                    >\n                      {subject.name}\n                      <button\n                        type=\"button\"\n                        onClick={() => handleRemoveSubject(subject.id)}\n                        className=\"hover:bg-blue-200 rounded-full p-1\"\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </button>\n                    </div>\n                  ))}\n              </div>\n            </div>\n            {errors.subjects && (\n              <p className=\"text-red-500 text-sm mt-1\">{errors.subjects}</p>\n            )}\n          </div>\n\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              id=\"editIsActive\"\n              checked={formData.isActive}\n              onChange={e =>\n                setFormData({ ...formData, isActive: e.target.checked })\n              }\n            />\n            <label htmlFor=\"editIsActive\">Active</label>\n          </div>\n          <div className=\"flex gap-2 pt-4\">\n            <button\n              type=\"submit\"\n              disabled={updateMutation.isPending}\n              className=\"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50\"\n            >\n              {updateMutation.isPending ? 'Updating...' : 'Update Group'}\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => {\n                setShowEditDialog(false)\n                resetForm()\n              }}\n              className=\"border px-4 py-2 rounded-lg hover:bg-gray-50\"\n            >\n              Cancel\n            </button>\n          </div>\n        </form>\n      </Dialog>\n    </div>\n  )\n}\n\nexport default SubjectGroups\n"
        }
    ]
}